#!/bin/sh

cd success-factory

# Run lint-staged (ESLint + Prettier on staged files only)
echo "ğŸ” Running lint-staged..."
npx lint-staged || {
  echo "âŒ Lint-staged failed. Please fix errors before committing."
  exit 1
}

# Run TypeScript type check
echo "ğŸ“˜ Running TypeScript check..."
npm run typecheck --silent || {
  echo "âŒ TypeScript check failed. Please fix type errors before committing."
  exit 1
}

# Run secrets detection on staged files
echo "ğŸ” Checking for secrets..."
# Use -z flag with git and -0 with xargs to handle filenames with special characters
git diff --cached --name-only -z --diff-filter=ACM | xargs -0 -r npx secretlint 2>/dev/null || {
  echo "âŒ Secrets detected! Please remove sensitive data before committing."
  exit 1
}

# Run color audit
echo "ğŸ¨ Running color audit..."
node scripts/audit-colors.cjs || {
  echo "âŒ Color audit failed. Please use semantic color tokens."
  exit 1
}

echo "âœ… Pre-commit checks passed!"
exit 0
